(function(){angular.module("apiApp",["ngRoute","ui.bootstrap","nvd3"]);function a(a){a.when("/",{templateUrl:"lista/lista.view.html",controller:"apiListCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/about/about.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/cv",{templateUrl:"/cv/cv.view.html",controller:"cvCtrl",controllerAs:"vm"}).when("/contacto",{templateUrl:"/contacto/contacto.view.html",controller:"contactoCtrl",controllerAs:"vm"}).when("/rest_api/nombre/:rest_apinombre/id/:rest_apiid",{templateUrl:function(a){var e;switch(a.rest_apinombre){case"INE":e="/apis/views/ine.view.html";break;case"ARAGON":e="/apis/views/aragon.view.html";break;case"NASA":e="/apis/views/nasa.view.html";break}return e},controller:"apiCtrl",controllerAs:"vm"}).when("/ine",{templateUrl:"/apis/views/resultadoIne.view.html",controller:"ineCtrl",controllerAs:"vm"}).when("/aragon",{templateUrl:"/apis/views/resultadoAragon.view.html",controller:"aragonCtrl",controllerAs:"vm"}).when("/nasa",{templateUrl:"/apis/views/resultadoNasa.view.html",controller:"nasaCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("apiApp").config(["$routeProvider",a])})();(function(){angular.module("apiApp").controller("apiListCtrl",a);a.$inject=["apiData","apiFactory"];function a(a,e){var t=this;t.mensaje="Buscando APIs disponibles";t.titulo="Lista de APIs";t.cabecera={titulo:"APIs disponibles",subtitulo:"Escoge la API"};a.apis().then(function(a){t.mensaje=a.data.length>0?"":"No se encontraron APIs";t.data={listaApis:a.data};e.setLista(t.data)}),function r(a){t.mensaje="Lo siento, algo fue mal"}}})();(function(){angular.module("apiApp").controller("aboutCtrl",a);a.$inject=["apiFactory"];function a(a){var e=this;e.cabecera="SOBRE LA WEB";e.listaApis=a.getLista()}})();(function(){angular.module("apiApp").controller("cvCtrl",a);a.$inject=["apiFactory"];function a(a){var e=this;e.listaApis=a.getLista()}})();(function(){angular.module("apiApp").controller("contactoCtrl",a);a.$inject=["apiFactory","contacto"];function a(a,e){var t=this;t.formError="";t.listaApis=a.getLista();var r=function(a){postdata={nombre:a.nombre,email:a.email,comentario:a.comentario};e.enviar(postdata).success(function(a){t.formError="Tu email ha sido enviado con éxito"}).error(function(a){t.formError="Tu email no ha sido enviado"});return false};t.onSubmit=function(){t.formError="";if(!t.formData.nombre||!t.formData.email||!t.formData.comentario){t.formError="Se requiere rellenar todos los campos";return false}else{t.formError="Mandando mensaje";r(t.formData);return false}};return false}})();(function(){angular.module("apiApp").controller("apiCtrl",a);a.$inject=["$routeParams","$modal","apiData","ine","aragon","nasa","apiFactory"];function a(a,e,t,r,o,n,i){var s=this;s.rest_apiid=a.rest_apiid;t.apiById(s.rest_apiid).then(function(a){s.mensaje=a.data.length>0?"":"No se encontraron APIs";switch(a.data.api){case"INE":s.titulo="Api INE";s.imagen={cabecera:a.data.nombre,descripcion:{linea1:"",linea2:""},pie:"",puntuacion:a.data.puntuacion};s.formulario={cabecera:"Población por sexo y comunidad",descripcion:{linea1:a.data.imagen,linea2:a.data.linea2},pie:""};s.recomendaciones=a.data.recomendaciones;s.rest_api=a.data._id;s.formError="Cargando controles API INE";s.listaApis=i.getLista();r.comunidades().then(function(a){r.sexos().then(function(a){console.log("datasexos: ",a);s.formError="";s.sexos=a.data}),function e(a){s.mensaje="Lo siento, algo fue mal cargando variable Sexos en INE"};s.comunidades=a.data}),function c(a){s.mensaje="Lo siento, algo fue mal cargando variable Comunidades en INE"};s.onSubmit=function(){s.formError="";if(!s.formData.comunidad){s.formError="Se requiere rellenar el campo Comunidad Autónoma";return false}else{s.formError="Accediendo a INE";e(s.formData);return false}};var e=function(e){r.respuestaIne(e).then(function(t){e._id=a.data._id;e.api=a.data.api;r.setDetalle(t,e._id,e.api);window.location="/#ine"}),function t(a){s.formError="Error al llamar al Servidor INE"};return false};break;case"ARAGON":s.titulo="Api Aragón Open Data";s.imagen={cabecera:a.data.nombre,descripcion:{linea1:"",linea2:""},pie:"",puntuacion:a.data.puntuacion};s.formulario={cabecera:"Datos de redes sociales",descripcion:{linea1:a.data.imagen,linea2:a.data.linea2},pie:""};s.recomendaciones=a.data.recomendaciones;s.listaApis=i.getLista();s.mensaje="";s.tipos=["event","text","wiki","video","picture","venue","code","media"];s.fuentes=["spain_info","facebook_events","twitter","youtube","instagram","facebook","wikipedia","blogger","wordpress","blogia","vimeo","flickr","foursquare","pinterest","google_plus","github","heraldodearagon","periodicodearagon","diariodelaltoaragon","diariodeteruel"];s.opciones=[{etiqueta:"Tipo de contenido",valor:"type"},{etiqueta:"Fuente de datos",valor:"source"},{etiqueta:"Datos cercanos al usuario",valor:"center"}];s.onSubmit=function(){s.formError="";if(!s.formData.opcion){s.formError="Se requiere rellenar el campo Seleccionar";return false}else{s.formError="Accediendo a Aragón Open Data";t(s.formData);return false}};var t=function(e){o.respuestaAragon(e).then(function(t){e._id=a.data._id;e.api=a.data.api;o.setDetalle(t,e._id,e.api);window.location="/#aragon"}),function t(a){s.formError="Error al llamar al Servidor Aragón Open Data"};return false};break;case"NASA":s.titulo="Api NASA";s.imagen={cabecera:a.data.nombre,descripcion:{linea1:"",linea2:""},pie:"",puntuacion:a.data.puntuacion};s.formulario={cabecera:"Fotos por Rover, cámara y día",descripcion:{linea1:a.data.imagen,linea2:a.data.linea2},pie:""};s.recomendaciones=a.data.recomendaciones;s.rest_api=a.data._id;s.mensaje="";s.mensaje="";s.rovers=[{nombre:"Curiosity",camaras:[0,1,2,3,4,5,6]},{nombre:"Opportunity",camaras:[0,1,6,7,8]},{nombre:"Spirit",camaras:[0,1,6,7,8]}];s.camara_set1=[{abreviatura:"FHAZ",nombre:"Front Hazard Avoidance Camera"},{abreviatura:"RHAZ",nombre:"Rear Hazard Avoidance Camera"},{abreviatura:"MAST",nombre:"Mast Camera"},{abreviatura:"CHEMCAM",nombre:"Chemistry and Camera Complex"},{abreviatura:"MAHLI",nombre:"Mars Hand Lens Imager"},{abreviatura:"MARDI",nombre:"Mars Descent Imager"},{abreviatura:"NAVCAM",nombre:"Navigation Camera"}];s.camara_set2=[{abreviatura:"FHAZ",nombre:"Front Hazard Avoidance Camera"},{abreviatura:"RHAZ",nombre:"Rear Hazard Avoidance Camera"},{abreviatura:"NAVCAM",nombre:"Navigation Camera"},{abreviatura:"PANCAM",nombre:"Panoramic Camera"},{abreviatura:"MINITES",nombre:"Miniature Thermal Emission Spectrometer"}];s.listaApis=i.getLista();s.onSubmit=function(){s.formError="";if(!s.formData.rover||!s.formData.camara_set1&&!s.formData.camara_set2){s.formError="Se requiere rellenar todos los campos";return false}else{s.formError="Accediendo a NASA";l(s.formData);return false}};var l=function(e){n.respuestaNasa(e).then(function(t){console.log("respuesta: ",t.data);if(t.data.photos.length==0){console.log("no datos nasa");s.formError="NO HAY DATOS para esa combinación, prueba de nuevo"}else{e._id=a.data._id;e.api=a.data.api;n.setDetalle(t,e._id,e.api);window.location="/#nasa"}}),function t(a){s.formError="Error al llamar al Servidor de NASA"};return false};break}s.data={api:a.data}}),function l(a){s.mensaje="Lo siento, algo fue mal"};s.pageHeader={title:s.rest_apiid};s.popupRecomendacionForm=function(){var a=e.open({templateUrl:"/recomendacionModal/recomendacionModal.view.html",controller:"recomendacionModalCtrl as vm",resolve:{apiDatos:function(){return{rest_apiid:s.rest_api,rest_apiNombre:s.titulo}}}});a.result.then(function(a){s.recomendaciones.push(a)})}}})();(function(){angular.module("apiApp").controller("ineCtrl",a);a.$inject=["ine","apiFactory","$scope"];function a(a,e,t){var r=this;var o=a.getDetalle();r.cabecera={titulo:"Instituto Nacional de Estadística",subtitulo:""};r.listaApis=e.getLista();r.formError="";r.datosgrafico=o.resultado;r._id=o._id;r.api=o.api;var n=r.datosgrafico.data;var i=n.length;var s=n[0].Data.length;var l=n[0].Nombre.split(".")[0];t.options={chart:{type:"lineChart",height:300,margin:{top:20,right:20,bottom:40,left:55},x:function(a){return a.x},y:function(a){return a.y},useInteractiveGuideline:false,dispatch:{stateChange:function(a){console.log("stateChange")},changeState:function(a){console.log("changeState")},tooltipShow:function(a){console.log("tooltipShow")},tooltipHide:function(a){console.log("tooltipHide")}},xAxis:{axisLabel:"Año",tickFormat:function(a){return d3.format(",")(a)},axisLabelDistance:0},yAxis:{axisLabel:"Población",tickFormat:function(a){return d3.format(",")(a)},axisLabelDistance:-5},callback:function(a){console.log("!!! lineChart callback !!!")}},title:{enable:true,text:"Cifras oficiales de población "+l},subtitle:{enable:true,text:"Fuente: Instituto Nacional de Estadística",css:{"text-align":"center",margin:"10px 13px 0px 7px"}},caption:{enable:false,html:'<b>Figure 1.</b> Lorem ipsum dolor sit amet, at eam blandit sadipscing, <span style="text-decoration: underline;">vim adhuc sanctus disputando ex</span>, cu usu affert alienum urbanitas. <i>Cum in purto erat, mea ne nominavi persecuti reformidans.</i> Docendi blandit abhorreant ea has, minim tantas alterum pro eu. <span style="color: darkred;">Exerci graeci ad vix, elit tacimates ea duo</span>. Id mel eruditi fuisset. Stet vidit patrioque in pro, eum ex veri verterem abhorreant, id unum oportere intellegam nec<sup>[1, <a href="https://github.com/krispo/angular-nvd3" target="_blank">2</a>, 3]</sup>.',css:{"text-align":"justify",margin:"10px 13px 0px 7px"}}};t.data=c();function c(){var a,e;var t=function(e){var t=new Array;for(a=s-1;a>=0;a--){t[s-a-1]={x:n[e].Data[a].Anyo,y:n[e].Data[a].Valor}}return t};var r=[];for(e=0;e<i;e++){if(n[e].Nombre.indexOf("Hombres")<0&&n[e].Nombre.indexOf("Mujeres")<0){r[e]={values:t(e),key:"Todos",strokeWidth:2,classed:"dashed"}}else if(n[e].Nombre.indexOf("Mujeres")<0){r[e]={values:t(e),key:"Hombres"}}else{r[e]={values:t(e),key:"Mujeres"}}}return r}}})();(function(){angular.module("apiApp").controller("aragonCtrl",a);a.$inject=["aragon","apiFactory"];function a(a,e){var t=a.getDetalle();var r=this;r.cabecera={titulo:"Api Aragón Open Data",subtitulo:""};if(t.resultado.data.status=="NOK"){r.formError="Aragon Open Data no tiene datos para las opciones propuestas, intenta de nuevo";r._id=t._id;r.api=t.api}else{r.formError="";r.resultado=t.resultado;r._id=t._id;r.api=t.api}r.listaApis=e.getLista()}})();(function(){angular.module("apiApp").controller("nasaCtrl",a);a.$inject=["nasa","apiFactory"];function a(a,e){var t=this;var r=a.getDetalle();t.cabecera={titulo:"Api NASA",subtitulo:""};t.formError="";t.resultado=r.resultado;t._id=r._id;t.api=r.api;t.listaApis=e.getLista()}})();(function(){angular.module("apiApp").controller("recomendacionModalCtrl",a);a.$inject=["$modalInstance","apiData","apiDatos"];function a(a,e,t){var r=this;r.apiDatos=t;r.modal={close:function(e){a.close(e)},cancel:function(){a.dismiss("cancel")}};r.onSubmit=function(){r.formError="";if(!r.formData.nombre||!r.formData.puntuacion||!r.formData.comentario){r.formError="Se requieren todos los campos, inténtalo de nuevo";return false}else{r.doAddRecomendacion(r.apiDatos.rest_apiid,r.formData)}};r.doAddRecomendacion=function(a,t){e.addRecomendacionId(a,{autor:t.nombre,puntuacion:t.puntuacion,comentario:t.comentario}).success(function(a){r.modal.close(a)}).error(function(a){r.formError="Tu recomendación no ha sido guardada, inténtalo de nuevo"});return false}}})();(function(){angular.module("apiApp").service("apiData",a);a.$inject=["$http"];function a(a){var e=function(){return a.get("/api/rest_apis")};var t=function(e){return a.get("/api/rest_apis/"+e)};var r=function(e,t){return a.post("/api/rest_apis/"+e+"/recomendaciones",t)};return{apis:e,apiById:t,addRecomendacionId:r}}})();(function(){angular.module("apiApp").service("ine",a);a.$inject=["$http"];function a(a){var e;var t=function(e){var t="http://servicios.ine.es/wstempus/js/ES";var r="/DATOS_METADATAOPERACION/CP?"+"g1="+"70:"+e.comunidad+"&g2="+"18:"+e.sexo+"&g3=356:15668"+"&g4=141:16420"+"&p=12"+"&nult="+e.periodo;return a.get(t+r)};var r=function(){var e="http://servicios.ine.es/wstempus/js/ES";var t="/VALORES_VARIABLEOPERACION/70/CP";return a.get(e+t)};var o=function(){servidor="http://servicios.ine.es/wstempus/js/ES";path="/VALORES_VARIABLEOPERACION/18/CP";return a.get(servidor+path)};var n=function(a,t,r){e={resultado:a,_id:t,api:r}};var i=function(){return e};return{respuestaIne:t,comunidades:r,sexos:o,setDetalle:n,getDetalle:i}}})();(function(){angular.module("apiApp").service("aragon",a);a.$inject=["$http"];function a(a){var e=function(e){var t;if(e.opcion=="type"){t=e.tipo}else if(e.opcion=="source"){t=e.fuente}else if(e.opcion=="center"){t=e.latitud+","+e.longitud+"&distance="+e.centrar}servidor="https://opendata.aragon.es/socialdata/data";path="?"+e.opcion+"="+t;return a.get(servidor+path)};var t=function(a,e,t){detalle={resultado:a,_id:e,api:t}};var r=function(){return detalle};return{respuestaAragon:e,setDetalle:t,getDetalle:r}}})();(function(){angular.module("apiApp").service("nasa",a);a.$inject=["$http"];function a(a){var e=function(e){var t;const r="OQFS2VMIAbziDemptL3TohOB5FHghLo6pyGou5K7";if(e.rover=="Curiosity"){t=e.camara_set1}else if(e.rover=="Opportunity"||e.rover=="Spirit"){t=e.camara_set2}else{t=""}servidor="https://api.nasa.gov/mars-photos/api/v1";path="/rovers/"+e.rover+"/photos?"+"sol="+e.sol+"&camera="+t+"&api_key="+r;console.log("path: ",path);return a.get(servidor+path)};var t=function(a,e,t){detalle={resultado:a,_id:e,api:t}};var r=function(){console.log("detalle: ",detalle);return detalle};return{respuestaNasa:e,setDetalle:t,getDetalle:r}}})();(function(){angular.module("apiApp").service("contacto",a);a.$inject=["$http"];function a(a){var e=function(e){var t="sandbox5e354e754739478fbde79f69cb2b5b83.mailgun.org";var r=window.btoa("api:9bbcd1471632ff6a33f1ce73e80905e2-c1fe131e-68ae4c6c");console.log("elbtoa",r);a({method:"POST",url:"https://api.mailgun.net/v3/"+t+"/messages",headers:{"Content-Type":"multipart/form-data",Authorization:"Basic "+r},data:"from="+"test@example.com"+"&to="+"shigaloa@gmail.com"+"&subject="+"MailgunTest"+"&text="+"EmailBody"});return false};var t=function(e){return a.post("/adenda/contacto",e)};return{send:e,enviar:t}}})();(function(){angular.module("apiApp").factory("apiFactory",a);function a(){var a=[];return{getLista:function(){return a},setLista:function(e){a=e}}}})();(function(){angular.module("apiApp").filter("limitaCadena",e);var a=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};function e(){return function(a){if(a){return a.substr(0,40)}else{return""}}}})();(function(){angular.module("apiApp").directive("estrellas",a);function a(){return{scope:{estaPuntuacion:"=puntuacion"},templateUrl:"/common/directives/estrellas/estrellas.template.html"}}})();(function(){angular.module("apiApp").directive("footerGenerico",a);function a(){return{restrict:"EA",templateUrl:"/common/directives/footerGenerico/footerGenerico.template.html"}}})();(function(){angular.module("apiApp").directive("navigation",a);function a(){return{restrict:"EA",scope:{listaApis:"=content"},templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("apiApp").directive("gotop",a);a.$inject=["$anchorScroll","$location"];function a(a,e){return{restrict:"EA",link:function(t,r,o){e.hash(o.id);a()}}}})();