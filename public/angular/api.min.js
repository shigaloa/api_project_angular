(function(){angular.module("apiApp",["ngRoute","ui.bootstrap","nvd3"]);function a(a){a.when("/",{templateUrl:"lista/lista.view.html",controller:"apiListCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"/about/about.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/cv",{templateUrl:"/cv/cv.view.html",controller:"cvCtrl",controllerAs:"vm"}).when("/contacto",{templateUrl:"/contacto/contacto.view.html",controller:"contactoCtrl",controllerAs:"vm"}).when("/rest_api/nombre/:rest_apinombre/id/:rest_apiid",{templateUrl:function(a){var e;switch(a.rest_apinombre){case"INE":e="/apis/views/ine.view.html";break;case"ARAGON":e="/apis/views/aragon.view.html";break;case"NASA":e="/apis/views/nasa.view.html";break}return e},controller:"apiCtrl",controllerAs:"vm"}).when("/ine",{templateUrl:"/apis/views/resultadoIne.view.html",controller:"ineCtrl",controllerAs:"vm"}).when("/aragon",{templateUrl:"/apis/views/resultadoAragon.view.html",controller:"aragonCtrl",controllerAs:"vm"}).when("/nasa",{templateUrl:"/apis/views/resultadoNasa.view.html",controller:"nasaCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("apiApp").config(["$routeProvider",a])})();(function(){angular.module("apiApp").controller("apiListCtrl",a);a.$inject=["apiData","apiFactory"];function a(a,e){var r=this;r.mensaje="Buscando APIs disponibles";r.titulo="Lista de APIs";r.cabecera={titulo:"APIs disponibles",subtitulo:"Escoge la API"};a.apis().then(function(a){r.mensaje=a.data.length>0?"":"No se encontraron APIs";r.data={listaApis:a.data};e.setLista(r.data)}),function t(a){r.mensaje="Lo siento, algo fue mal"}}})();(function(){angular.module("apiApp").controller("aboutCtrl",a);a.$inject=["apiFactory"];function a(a){var e=this;e.cabecera="SOBRE LA WEB";e.listaApis=a.getLista()}})();(function(){angular.module("apiApp").controller("cvCtrl",a);a.$inject=["apiFactory"];function a(a){var e=this;e.listaApis=a.getLista()}})();(function(){angular.module("apiApp").controller("contactoCtrl",a);a.$inject=["apiFactory","contacto"];function a(a,e){var r=this;r.formError="";r.listaApis=a.getLista();var t=function(a){postdata={nombre:a.nombre,email:a.email,comentario:a.comentario};e.enviar(postdata).success(function(a){r.formError="Tu email ha sido enviado con éxito"}).error(function(a){r.formError="Tu email no ha sido enviado"});return false};r.onSubmit=function(){r.formError="";if(!r.formData.nombre||!r.formData.email||!r.formData.comentario){r.formError="Se requiere rellenar todos los campos";return false}else{r.formError="Mandando mensaje";t(r.formData);return false}};return false}})();(function(){angular.module("apiApp").controller("apiCtrl",a);a.$inject=["$routeParams","$modal","apiData","ine","aragon","nasa","apiFactory"];function a(a,e,r,t,o,i,n){var l=this;l.rest_apiid=a.rest_apiid;r.apiById(l.rest_apiid).then(function(a){l.mensaje=a.data.length>0?"":"No se encontraron APIs";switch(a.data.api){case"INE":l.titulo="Api INE";l.imagen={cabecera:a.data.nombre,descripcion:{linea1:"",linea2:""},pie:"",puntuacion:a.data.puntuacion};l.formulario={cabecera:"Población por sexo y comunidad",descripcion:{linea1:a.data.imagen,linea2:a.data.linea2},pie:""};l.recomendaciones=a.data.recomendaciones;l.rest_api=a.data._id;l.formError="Cargando controles API INE";l.listaApis=n.getLista();l.comunidades=[{Id:8995,Fk_Variable:70,Nombre:"Melilla",Codigo:"19"},{Id:8997,Fk_Variable:70,Nombre:"Andalucía",Codigo:"01"},{Id:8998,Fk_Variable:70,Nombre:"Aragón",Codigo:"02"},{Id:8999,Fk_Variable:70,Nombre:"Asturias, Principado de",Codigo:"03"},{Id:9e3,Fk_Variable:70,Nombre:"Balears, Illes",Codigo:"04"},{Id:9001,Fk_Variable:70,Nombre:"Canarias",Codigo:"05"},{Id:9002,Fk_Variable:70,Nombre:"Cantabria",Codigo:"06"},{Id:9003,Fk_Variable:70,Nombre:"Castilla y León",Codigo:"07"},{Id:9004,Fk_Variable:70,Nombre:"Castilla - La Mancha",Codigo:"08"},{Id:9005,Fk_Variable:70,Nombre:"Cataluña",Codigo:"09"},{Id:9006,Fk_Variable:70,Nombre:"Comunitat Valenciana",Codigo:"10"},{Id:9007,Fk_Variable:70,Nombre:"Extremadura",Codigo:"11"},{Id:9008,Fk_Variable:70,Nombre:"Galicia",Codigo:"12"},{Id:9009,Fk_Variable:70,Nombre:"Madrid, Comunidad de",Codigo:"13"},{Id:9010,Fk_Variable:70,Nombre:"Murcia, Región de",Codigo:"14"},{Id:9011,Fk_Variable:70,Nombre:"Navarra, Comunidad Foral de",Codigo:"15"},{Id:9012,Fk_Variable:70,Nombre:"País Vasco",Codigo:"16"},{Id:9013,Fk_Variable:70,Nombre:"Rioja, La",Codigo:"17"},{Id:9015,Fk_Variable:70,Nombre:"Ceuta",Codigo:"18"}];l.sexos=[{Id:451,Fk_Variable:18,Nombre:"Total",Codigo:""},{Id:452,Fk_Variable:18,Nombre:"Hombres",Codigo:"1"},{Id:453,Fk_Variable:18,Nombre:"Mujeres",Codigo:"6"}];l.onSubmit=function(){l.formError="";if(!l.formData.comunidad){l.formError="Se requiere rellenar el campo Comunidad Autónoma";return false}else{l.formError="Accediendo a INE";e(l.formData);return false}};var e=function(e){t.respuestaIne(e).then(function(r){e._id=a.data._id;e.api=a.data.api;t.setDetalle(r,e._id,e.api);window.location="/#ine"}),function r(a){l.formError="Error al llamar al Servidor INE"};return false};break;case"ARAGON":l.titulo="Api Aragón Open Data";l.imagen={cabecera:a.data.nombre,descripcion:{linea1:"",linea2:""},pie:"",puntuacion:a.data.puntuacion};l.formulario={cabecera:"Datos de redes sociales",descripcion:{linea1:a.data.imagen,linea2:a.data.linea2},pie:""};l.recomendaciones=a.data.recomendaciones;l.listaApis=n.getLista();l.mensaje="";l.tipos=["event","text","wiki","video","picture","venue","code","media"];l.fuentes=["spain_info","facebook_events","twitter","youtube","instagram","facebook","wikipedia","blogger","wordpress","blogia","vimeo","flickr","foursquare","pinterest","google_plus","github","heraldodearagon","periodicodearagon","diariodelaltoaragon","diariodeteruel"];l.opciones=[{etiqueta:"Tipo de contenido",valor:"type"},{etiqueta:"Fuente de datos",valor:"source"},{etiqueta:"Datos cercanos al usuario",valor:"center"}];l.onSubmit=function(){l.formError="";if(!l.formData.opcion){l.formError="Se requiere rellenar el campo Seleccionar";return false}else{l.formError="Accediendo a Aragón Open Data";r(l.formData);return false}};var r=function(e){o.respuestaAragon(e).then(function(r){e._id=a.data._id;e.api=a.data.api;o.setDetalle(r,e._id,e.api);window.location="/#aragon"}),function r(a){l.formError="Error al llamar al Servidor Aragón Open Data"};return false};break;case"NASA":l.titulo="Api NASA";l.imagen={cabecera:a.data.nombre,descripcion:{linea1:"",linea2:""},pie:"",puntuacion:a.data.puntuacion};l.formulario={cabecera:"Fotos por Rover, cámara y día",descripcion:{linea1:a.data.imagen,linea2:a.data.linea2},pie:""};l.recomendaciones=a.data.recomendaciones;l.rest_api=a.data._id;l.mensaje="";l.mensaje="";l.rovers=[{nombre:"Curiosity",camaras:[0,1,2,3,4,5,6]},{nombre:"Opportunity",camaras:[0,1,6,7,8]},{nombre:"Spirit",camaras:[0,1,6,7,8]}];l.camara_set1=[{abreviatura:"FHAZ",nombre:"Front Hazard Avoidance Camera"},{abreviatura:"RHAZ",nombre:"Rear Hazard Avoidance Camera"},{abreviatura:"MAST",nombre:"Mast Camera"},{abreviatura:"CHEMCAM",nombre:"Chemistry and Camera Complex"},{abreviatura:"MAHLI",nombre:"Mars Hand Lens Imager"},{abreviatura:"MARDI",nombre:"Mars Descent Imager"},{abreviatura:"NAVCAM",nombre:"Navigation Camera"}];l.camara_set2=[{abreviatura:"FHAZ",nombre:"Front Hazard Avoidance Camera"},{abreviatura:"RHAZ",nombre:"Rear Hazard Avoidance Camera"},{abreviatura:"NAVCAM",nombre:"Navigation Camera"},{abreviatura:"PANCAM",nombre:"Panoramic Camera"},{abreviatura:"MINITES",nombre:"Miniature Thermal Emission Spectrometer"}];l.listaApis=n.getLista();l.onSubmit=function(){l.formError="";if(!l.formData.rover||!l.formData.camara_set1&&!l.formData.camara_set2){l.formError="Se requiere rellenar todos los campos";return false}else{l.formError="Accediendo a NASA";s(l.formData);return false}};var s=function(e){i.respuestaNasa(e).then(function(r){console.log("respuesta: ",r.data);if(r.data.photos.length==0){console.log("no datos nasa");l.formError="NO HAY DATOS para esa combinación, prueba de nuevo"}else{e._id=a.data._id;e.api=a.data.api;i.setDetalle(r,e._id,e.api);window.location="/#nasa"}}),function r(a){l.formError="Error al llamar al Servidor de NASA"};return false};break}l.data={api:a.data}}),function s(a){l.mensaje="Lo siento, algo fue mal"};l.pageHeader={title:l.rest_apiid};l.popupRecomendacionForm=function(){var a=e.open({templateUrl:"/recomendacionModal/recomendacionModal.view.html",controller:"recomendacionModalCtrl as vm",resolve:{apiDatos:function(){return{rest_apiid:l.rest_api,rest_apiNombre:l.titulo}}}});a.result.then(function(a){l.recomendaciones.push(a)})}}})();(function(){angular.module("apiApp").controller("ineCtrl",a);a.$inject=["ine","apiFactory","$scope"];function a(a,e,r){var t=this;var o=a.getDetalle();t.cabecera={titulo:"Instituto Nacional de Estadística",subtitulo:""};t.listaApis=e.getLista();t.formError="";t.datosgrafico=o.resultado;t._id=o._id;t.api=o.api;var i=t.datosgrafico.data;var n=i.length;var l=i[0].Data.length;var s=i[0].Nombre.split(".")[0];r.options={chart:{type:"lineChart",height:300,margin:{top:20,right:20,bottom:40,left:55},x:function(a){return a.x},y:function(a){return a.y},useInteractiveGuideline:false,dispatch:{stateChange:function(a){console.log("stateChange")},changeState:function(a){console.log("changeState")},tooltipShow:function(a){console.log("tooltipShow")},tooltipHide:function(a){console.log("tooltipHide")}},xAxis:{axisLabel:"Año",tickFormat:function(a){return d3.format(",")(a)},axisLabelDistance:0},yAxis:{axisLabel:"Población",tickFormat:function(a){return d3.format(",")(a)},axisLabelDistance:-5},callback:function(a){console.log("!!! lineChart callback !!!")}},title:{enable:true,text:"Cifras oficiales de población "+s},subtitle:{enable:true,text:"Fuente: Instituto Nacional de Estadística",css:{"text-align":"center",margin:"10px 13px 0px 7px"}},caption:{enable:false,html:'<b>Figure 1.</b> Lorem ipsum dolor sit amet, at eam blandit sadipscing, <span style="text-decoration: underline;">vim adhuc sanctus disputando ex</span>, cu usu affert alienum urbanitas. <i>Cum in purto erat, mea ne nominavi persecuti reformidans.</i> Docendi blandit abhorreant ea has, minim tantas alterum pro eu. <span style="color: darkred;">Exerci graeci ad vix, elit tacimates ea duo</span>. Id mel eruditi fuisset. Stet vidit patrioque in pro, eum ex veri verterem abhorreant, id unum oportere intellegam nec<sup>[1, <a href="https://github.com/krispo/angular-nvd3" target="_blank">2</a>, 3]</sup>.',css:{"text-align":"justify",margin:"10px 13px 0px 7px"}}};r.data=c();function c(){var a,e;var r=function(e){var r=new Array;for(a=l-1;a>=0;a--){r[l-a-1]={x:i[e].Data[a].Anyo,y:i[e].Data[a].Valor}}return r};var t=[];for(e=0;e<n;e++){if(i[e].Nombre.indexOf("Hombres")<0&&i[e].Nombre.indexOf("Mujeres")<0){t[e]={values:r(e),key:"Todos",strokeWidth:2,classed:"dashed"}}else if(i[e].Nombre.indexOf("Mujeres")<0){t[e]={values:r(e),key:"Hombres"}}else{t[e]={values:r(e),key:"Mujeres"}}}return t}}})();(function(){angular.module("apiApp").controller("aragonCtrl",a);a.$inject=["aragon","apiFactory"];function a(a,e){var r=a.getDetalle();var t=this;t.cabecera={titulo:"Api Aragón Open Data",subtitulo:""};if(r.resultado.data.status=="NOK"){t.formError="Aragon Open Data no tiene datos para las opciones propuestas, intenta de nuevo";t._id=r._id;t.api=r.api}else{t.formError="";t.resultado=r.resultado;t._id=r._id;t.api=r.api}t.listaApis=e.getLista()}})();(function(){angular.module("apiApp").controller("nasaCtrl",a);a.$inject=["nasa","apiFactory"];function a(a,e){var r=this;var t=a.getDetalle();r.cabecera={titulo:"Api NASA",subtitulo:""};r.formError="";r.resultado=t.resultado;r._id=t._id;r.api=t.api;r.listaApis=e.getLista()}})();(function(){angular.module("apiApp").controller("recomendacionModalCtrl",a);a.$inject=["$modalInstance","apiData","apiDatos"];function a(a,e,r){var t=this;t.apiDatos=r;t.modal={close:function(e){a.close(e)},cancel:function(){a.dismiss("cancel")}};t.onSubmit=function(){t.formError="";if(!t.formData.nombre||!t.formData.puntuacion||!t.formData.comentario){t.formError="Se requieren todos los campos, inténtalo de nuevo";return false}else{t.doAddRecomendacion(t.apiDatos.rest_apiid,t.formData)}};t.doAddRecomendacion=function(a,r){e.addRecomendacionId(a,{autor:r.nombre,puntuacion:r.puntuacion,comentario:r.comentario}).success(function(a){t.modal.close(a)}).error(function(a){t.formError="Tu recomendación no ha sido guardada, inténtalo de nuevo"});return false}}})();(function(){angular.module("apiApp").service("apiData",a);a.$inject=["$http"];function a(a){var e=function(){return a.get("/api/rest_apis")};var r=function(e){return a.get("/api/rest_apis/"+e)};var t=function(e,r){return a.post("/api/rest_apis/"+e+"/recomendaciones",r)};return{apis:e,apiById:r,addRecomendacionId:t}}})();(function(){angular.module("apiApp").service("ine",a);a.$inject=["$http"];function a(a){var e;var r=function(e){var r="http://servicios.ine.es/wstempus/js/ES";var t="/DATOS_METADATAOPERACION/CP?"+"g1="+"70:"+e.comunidad+"&g2="+"18:"+e.sexo+"&g3=356:15668"+"&g4=141:16420"+"&p=12"+"&nult="+e.periodo;return a.get(r+t)};var t=function(){var e="http://servicios.ine.es/wstempus/js/ES";var r="/VALORES_VARIABLEOPERACION/70/CP";return a.get(e+r)};var o=function(){servidor="http://servicios.ine.es/wstempus/js/ES";path="/VALORES_VARIABLEOPERACION/18/CP";return a.get(servidor+path)};var i=function(a,r,t){e={resultado:a,_id:r,api:t}};var n=function(){return e};return{respuestaIne:r,comunidades:t,sexos:o,setDetalle:i,getDetalle:n}}})();(function(){angular.module("apiApp").service("aragon",a);a.$inject=["$http"];function a(a){var e=function(e){var r;if(e.opcion=="type"){r=e.tipo}else if(e.opcion=="source"){r=e.fuente}else if(e.opcion=="center"){r=e.latitud+","+e.longitud+"&distance="+e.centrar}servidor="https://opendata.aragon.es/socialdata/data";path="?"+e.opcion+"="+r;return a.get(servidor+path)};var r=function(a,e,r){detalle={resultado:a,_id:e,api:r}};var t=function(){return detalle};return{respuestaAragon:e,setDetalle:r,getDetalle:t}}})();(function(){angular.module("apiApp").service("nasa",a);a.$inject=["$http"];function a(a){var e=function(e){var r;const t="OQFS2VMIAbziDemptL3TohOB5FHghLo6pyGou5K7";if(e.rover=="Curiosity"){r=e.camara_set1}else if(e.rover=="Opportunity"||e.rover=="Spirit"){r=e.camara_set2}else{r=""}servidor="https://api.nasa.gov/mars-photos/api/v1";path="/rovers/"+e.rover+"/photos?"+"sol="+e.sol+"&camera="+r+"&api_key="+t;console.log("path: ",path);return a.get(servidor+path)};var r=function(a,e,r){detalle={resultado:a,_id:e,api:r}};var t=function(){console.log("detalle: ",detalle);return detalle};return{respuestaNasa:e,setDetalle:r,getDetalle:t}}})();(function(){angular.module("apiApp").service("contacto",a);a.$inject=["$http"];function a(a){var e=function(e){var r="sandbox5e354e754739478fbde79f69cb2b5b83.mailgun.org";var t=window.btoa("api:9bbcd1471632ff6a33f1ce73e80905e2-c1fe131e-68ae4c6c");console.log("elbtoa",t);a({method:"POST",url:"https://api.mailgun.net/v3/"+r+"/messages",headers:{"Content-Type":"multipart/form-data",Authorization:"Basic "+t},data:"from="+"test@example.com"+"&to="+"shigaloa@gmail.com"+"&subject="+"MailgunTest"+"&text="+"EmailBody"});return false};var r=function(e){return a.post("/adenda/contacto",e)};return{send:e,enviar:r}}})();(function(){angular.module("apiApp").factory("apiFactory",a);function a(){var a=[];return{getLista:function(){return a},setLista:function(e){a=e}}}})();(function(){angular.module("apiApp").filter("limitaCadena",e);var a=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};function e(){return function(a){if(a){return a.substr(0,40)}else{return""}}}})();(function(){angular.module("apiApp").directive("estrellas",a);function a(){return{scope:{estaPuntuacion:"=puntuacion"},templateUrl:"/common/directives/estrellas/estrellas.template.html"}}})();(function(){angular.module("apiApp").directive("footerGenerico",a);function a(){return{restrict:"EA",templateUrl:"/common/directives/footerGenerico/footerGenerico.template.html"}}})();(function(){angular.module("apiApp").directive("navigation",a);function a(){return{restrict:"EA",scope:{listaApis:"=content"},templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("apiApp").directive("gotop",a);a.$inject=["$anchorScroll","$location"];function a(a,e){return{restrict:"EA",link:function(r,t,o){e.hash(o.id);a()}}}})();